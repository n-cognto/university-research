{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Daily Climate Data Entry" %}{% endblock %}

{% block content %}
<div class="container my-4">
    <h1>{% trans "Daily Climate Data Entry" %}</h1>
    <p class="lead">{% trans "Add climate data to a station's data stack for later processing." %}</p>

    <div class="row">
        <!-- Data Entry Form -->
        <div class="col-md-6">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">{% trans "Add New Data" %}</h4>
                </div>
                <div class="card-body">
                    <form method="post" class="form">
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {{ form.non_field_errors }}
                        </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            <label for="{{ form.station.id_for_label }}" class="form-label">{{ form.station.label }}</label>
                            {{ form.station }}
                            <div class="form-text">{{ form.station.help_text }}</div>
                            {% if form.station.errors %}
                            <div class="invalid-feedback d-block">{{ form.station.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.timestamp.id_for_label }}" class="form-label">{{ form.timestamp.label }}</label>
                            {{ form.timestamp }}
                            <div class="form-text">{{ form.timestamp.help_text }}</div>
                            {% if form.timestamp.errors %}
                            <div class="invalid-feedback d-block">{{ form.timestamp.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.temperature.id_for_label }}" class="form-label">{{ form.temperature.label }}</label>
                                {{ form.temperature }}
                                <div class="form-text">{{ form.temperature.help_text }}</div>
                                {% if form.temperature.errors %}
                                <div class="invalid-feedback d-block">{{ form.temperature.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.humidity.id_for_label }}" class="form-label">{{ form.humidity.label }}</label>
                                {{ form.humidity }}
                                <div class="form-text">{{ form.humidity.help_text }}</div>
                                {% if form.humidity.errors %}
                                <div class="invalid-feedback d-block">{{ form.humidity.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.precipitation.id_for_label }}" class="form-label">{{ form.precipitation.label }}</label>
                                {{ form.precipitation }}
                                <div class="form-text">{{ form.precipitation.help_text }}</div>
                                {% if form.precipitation.errors %}
                                <div class="invalid-feedback d-block">{{ form.precipitation.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.wind_speed.id_for_label }}" class="form-label">{{ form.wind_speed.label }}</label>
                                {{ form.wind_speed }}
                                <div class="form-text">{{ form.wind_speed.help_text }}</div>
                                {% if form.wind_speed.errors %}
                                <div class="invalid-feedback d-block">{{ form.wind_speed.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.wind_direction.id_for_label }}" class="form-label">{{ form.wind_direction.label }}</label>
                                {{ form.wind_direction }}
                                <div class="form-text">{{ form.wind_direction.help_text }}</div>
                                {% if form.wind_direction.errors %}
                                <div class="invalid-feedback d-block">{{ form.wind_direction.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.barometric_pressure.id_for_label }}" class="form-label">{{ form.barometric_pressure.label }}</label>
                                {{ form.barometric_pressure }}
                                <div class="form-text">{{ form.barometric_pressure.help_text }}</div>
                                {% if form.barometric_pressure.errors %}
                                <div class="invalid-feedback d-block">{{ form.barometric_pressure.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.air_quality_index.id_for_label }}" class="form-label">{{ form.air_quality_index.label }}</label>
                                {{ form.air_quality_index }}
                                <div class="form-text">{{ form.air_quality_index.help_text }}</div>
                                {% if form.air_quality_index.errors %}
                                <div class="invalid-feedback d-block">{{ form.air_quality_index.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.uv_index.id_for_label }}" class="form-label">{{ form.uv_index.label }}</label>
                                {{ form.uv_index }}
                                <div class="form-text">{{ form.uv_index.help_text }}</div>
                                {% if form.uv_index.errors %}
                                <div class="invalid-feedback d-block">{{ form.uv_index.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.soil_moisture.id_for_label }}" class="form-label">{{ form.soil_moisture.label }}</label>
                                {{ form.soil_moisture }}
                                <div class="form-text">{{ form.soil_moisture.help_text }}</div>
                                {% if form.soil_moisture.errors %}
                                <div class="invalid-feedback d-block">{{ form.soil_moisture.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.water_level.id_for_label }}" class="form-label">{{ form.water_level.label }}</label>
                                {{ form.water_level }}
                                <div class="form-text">{{ form.water_level.help_text }}</div>
                                {% if form.water_level.errors %}
                                <div class="invalid-feedback d-block">{{ form.water_level.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.cloud_cover.id_for_label }}" class="form-label">{{ form.cloud_cover.label }}</label>
                                {{ form.cloud_cover }}
                                <div class="form-text">{{ form.cloud_cover.help_text }}</div>
                                {% if form.cloud_cover.errors %}
                                <div class="invalid-feedback d-block">{{ form.cloud_cover.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.data_quality.id_for_label }}" class="form-label">{{ form.data_quality.label }}</label>
                                {{ form.data_quality }}
                                <div class="form-text">{{ form.data_quality.help_text }}</div>
                                {% if form.data_quality.errors %}
                                <div class="invalid-feedback d-block">{{ form.data_quality.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">{% trans "Add to Stack" %}</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Data Stacks Status -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0">{% trans "Data Stacks Status" %}</h4>
                </div>
                <div class="card-body">
                    {% if stations %}
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>{% trans "Station" %}</th>
                                        <th>{% trans "Stack Size" %}</th>
                                        <th>{% trans "Actions" %}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for station in stations %}
                                    <tr>
                                        <td>{{ station.name }}</td>
                                        <td>
                                            <div class="progress" style="height: 20px;">
                                                {% if station.percentage > 90 %}
                                                    <div class="progress-bar bg-danger" role="progressbar" style="width: {{ station.percentage }}%;" 
                                                         aria-valuenow="{{ station.stack_size }}" aria-valuemin="0" aria-valuemax="{{ station.max_size }}">
                                                        {{ station.stack_size }}/{{ station.max_size }}
                                                    </div>
                                                {% elif station.percentage > 70 %}
                                                    <div class="progress-bar bg-warning" role="progressbar" style="width: {{ station.percentage }}%;" 
                                                         aria-valuenow="{{ station.stack_size }}" aria-valuemin="0" aria-valuemax="{{ station.max_size }}">
                                                        {{ station.stack_size }}/{{ station.max_size }}
                                                    </div>
                                                {% else %}
                                                    <div class="progress-bar bg-success" role="progressbar" style="width: {{ station.percentage }}%;" 
                                                         aria-valuenow="{{ station.stack_size }}" aria-valuemin="0" aria-valuemax="{{ station.max_size }}">
                                                        {{ station.stack_size }}/{{ station.max_size }}
                                                    </div>
                                                {% endif %}
                                            </div>
                                            {% if station.auto_process %}
                                                <small class="text-muted">{% trans "Auto-process at" %} {{ station.threshold }}</small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <a href="{% url 'maps:stack_data_entry' %}?station={{ station.id }}" class="btn btn-sm btn-outline-primary">
                                                    {% trans "Add Data" %}
                                                </a>
                                                {% if station.stack_size > 0 %}
                                                <form method="post" action="{% url 'maps:process_station_stack' station.id %}">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-sm btn-success ms-1">
                                                        {% trans "Process Now" %}
                                                    </button>
                                                </form>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            {% trans "No active weather stations found." %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
