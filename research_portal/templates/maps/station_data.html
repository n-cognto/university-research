{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/hotspot.css' %}">
<style>
    .data-container {
        margin: 20px 0;
    }
    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    .data-table th, .data-table td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
    }
    .data-table th {
        background-color: #f5f5f5;
    }
    .data-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    .download-options {
        margin: 20px 0;
    }
    .download-btn {
        margin-right: 10px;
    }
    .chart-wrapper {
        position: relative;
        margin: 30px 0;
        padding: 20px;
        border: 2px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
    }
    .chart-wrapper h5 {
        margin-top: 0;
        margin-bottom: 20px;
        border-bottom: 2px solid #ddd;
        padding-bottom: 15px;
        font-size: 18px;
        color: #333;
    }
    .chart-container {
        position: relative;
        height: 1000px !important;
        width: 100% !important;
        min-height: 1000px !important;
    }
    .back-to-map {
        margin-bottom: 20px;
    }
    /* Fix for Chart.js overflow */
    canvas {
        height: 1000px !important;
        max-height: 1000px !important;
        min-height: 1000px !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="back-to-map">
                <a href="{% url 'maps:map' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Map
                </a>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 id="station-name">Weather Station Data</h2>
                    <p id="station-description" class="text-muted"></p>
                </div>
                <div class="card-body">
                    <div class="station-info">
                        <p><strong>Location:</strong> <span id="station-location"></span></p>
                        <p><strong>Altitude:</strong> <span id="station-altitude"></span> meters</p>
                        <p><strong>Installed:</strong> <span id="station-installed"></span></p>
                        <p><strong>Last Updated:</strong> <span id="last-updated"></span></p>
                    </div>
                    
                    <div class="download-options">
                        <h4>Download Data</h4>
                        <button id="download-json" class="btn btn-primary download-btn">
                            <i class="fas fa-file-code"></i> Download JSON
                        </button>
                        <button id="download-csv" class="btn btn-success download-btn">
                            <i class="fas fa-file-csv"></i> Download CSV
                        </button>
                    </div>
                    
                    <div class="data-container">
                        <h4>Recent Weather Data</h4>
                        <table class="data-table" id="weather-data-table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Temperature (°C)</th>
                                    <th>Precipitation (mm)</th>
                                    <th>Humidity (%)</th>
                                    <th>Wind Speed (m/s)</th>
                                </tr>
                            </thead>
                            <tbody id="data-table-body">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <h4 class="mt-4 mb-3">Weather Trends</h4>
                    
                    <div class="chart-wrapper">
                        <h5>Temperature Trend (°C)</h5>
                        <div class="chart-container">
                            <canvas id="temperature-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h5>Precipitation Trend (mm)</h5>
                        <div class="chart-container">
                            <canvas id="precipitation-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script src="{% static 'js/maps/station_data.js' %}"></script>
{% endblock %}
